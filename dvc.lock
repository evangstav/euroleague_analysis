schema: '2.0'
stages:
  extract:
    cmd: python euroleague_data_collector.py
    deps:
    - path: euroleague_data_collector.py
      hash: md5
      md5: 4a13f5453903a5c7aea255f7fa6e63a0
      size: 4781
    params:
      params.yaml:
        extract.competition_code: E
        extract.data_dir: euroleague_data
        extract.season: 2023
    outs:
    - path: euroleague_data/raw/
      hash: md5
      md5: 85270b6b4700f28722fe0780a36c0fcb.dir
      size: 2691311
      nfiles: 5
    - path: extract_outputs.json
      hash: md5
      md5: 184e8003bdd7aa5fb3a416bb91de5977
      size: 333
  features:
    cmd: python feature_engineering.py
    deps:
    - path: euroleague_data/raw/
      hash: md5
      md5: 85270b6b4700f28722fe0780a36c0fcb.dir
      size: 2691311
      nfiles: 5
    - path: feature_engineering.py
      hash: md5
      md5: bda91bdc8beb3bb6a364c73cf857e56c
      size: 35158
    params:
      params.yaml:
        features.data_dir: euroleague_data
        features.min_minutes: 0
        features.rolling_windows:
        - 3
        - 5
        features.season: 2023
    outs:
    - path: euroleague_data/features.duckdb
      hash: md5
      md5: f31fb2cf10bfba1105c068eb8e4c9145
      size: 274432
    - path: euroleague_data/features.parquet
      hash: md5
      md5: 147ed7fc7319c0d507c3208fb3e9a574
      size: 741819
    - path: feature_outputs.json
      hash: md5
      md5: 91afc263562fd94ed803ff9a634fa55f
      size: 105
  train:
    cmd: python train_model.py
    deps:
    - path: euroleague_data/features.parquet
      hash: md5
      md5: 147ed7fc7319c0d507c3208fb3e9a574
      size: 741819
    - path: train_model.py
      hash: md5
      md5: d9cf26231739a7f31a6d7cac3c2191d4
      size: 7463
    params:
      params.yaml:
        train.data_dir: euroleague_data
        train.early_stopping: true
        train.l2_regularization: 1.0
        train.learning_rate: 0.1
        train.max_depth: 5
        train.max_iter: 100
        train.min_samples_leaf: 20
        train.model_dir: models
        train.n_iter_no_change: 10
        train.n_splits: 5
        train.validation_fraction: 0.1
    outs:
    - path: models/feature_importance.json
      hash: md5
      md5: 5eec2e60d539aedc090c0543366b180d
      size: 3535
    - path: models/metrics.json
      hash: md5
      md5: a2f413968e93ea42df5ee49536945313
      size: 87
    - path: models/pir_predictor.joblib
      hash: md5
      md5: b28f2dcd7ff5c07b9f439d63c4732270
      size: 192006
    - path: models/scaler.joblib
      hash: md5
      md5: d69b62399a900f033551336dcf2fa0bd
      size: 2839
  analyze:
    cmd: python analyze_predictions.py
    deps:
    - path: analyze_predictions.py
      hash: md5
      md5: 86908fb3d9faac05e20896db5a543e4c
      size: 8390
    - path: euroleague_data/features.parquet
      hash: md5
      md5: 147ed7fc7319c0d507c3208fb3e9a574
      size: 741819
    - path: models/feature_importance.json
      hash: md5
      md5: 5eec2e60d539aedc090c0543366b180d
      size: 3535
    - path: models/pir_predictor.joblib
      hash: md5
      md5: b28f2dcd7ff5c07b9f439d63c4732270
      size: 192006
    - path: models/scaler.joblib
      hash: md5
      md5: d69b62399a900f033551336dcf2fa0bd
      size: 2839
    params:
      params.yaml:
        analyze.analysis_dir: analysis
        analyze.data_dir: euroleague_data
        analyze.model_dir: models
    outs:
    - path: analysis/actual_vs_predicted.png
      hash: md5
      md5: 992ae788f5830495d72454074663036f
      size: 107198
    - path: analysis/analysis_results.json
      hash: md5
      md5: e2f2faa5a92fa1c2241c49a233b78108
      size: 2493
    - path: analysis/error_by_pir_range.png
      hash: md5
      md5: d5816cc63d2734e3bbac1c6dad4629ca
      size: 44451
    - path: analysis/error_distribution.png
      hash: md5
      md5: b4891e9b751b95687fd1fcc17d23995e
      size: 30707
    - path: analysis/residuals.png
      hash: md5
      md5: d1d3129adf093d015af5f833d83b1ba1
      size: 114739
  train_pgm:
    cmd: python train_pgm.py
    deps:
    - path: euroleague_data/features.parquet
      hash: md5
      md5: 147ed7fc7319c0d507c3208fb3e9a574
      size: 741819
    - path: train_pgm.py
      hash: md5
      md5: 3f2d522028622bde3700e2c2a135a401
      size: 10446
    params:
      params.yaml:
        train_pgm.data_dir: euroleague_data
        train_pgm.model_dir: models_pgm
        train_pgm.n_chains: 2
        train_pgm.n_samples: 2000
        train_pgm.n_tune: 2000
    outs:
    - path: models_pgm/inference_data.nc
      hash: md5
      md5: 266687c272a9e2db9fd690b3eead00a9
      size: 8502378
    - path: models_pgm/metadata.joblib
      hash: md5
      md5: 1aca9e8251507c995733959f0d78451f
      size: 4078
    - path: models_pgm/pgm_metrics.json
      hash: md5
      md5: 921244797ef31ffe5a7a9d5256f7a341
      size: 182
    - path: models_pgm/pgm_parameters.json
      hash: md5
      md5: e4267d386541b99d07ac11ce2294b5ea
      size: 79798
    - path: models_pgm/scalers.joblib
      hash: md5
      md5: 2c5d6bca7f8aeef964bb8b8209e8fac5
      size: 2753
    - path: models_pgm/target_stats.joblib
      hash: md5
      md5: 073574cf6632c2712aadc3dd2b0b5c1e
      size: 47
  analyze_pgm:
    cmd: python analyze_pgm.py
    deps:
    - path: analyze_pgm.py
      hash: md5
      md5: eb04a889bef4d299baa3f2dd3ae6a3f5
      size: 13608
    - path: euroleague_data/features.parquet
      hash: md5
      md5: 147ed7fc7319c0d507c3208fb3e9a574
      size: 741819
    - path: models_pgm/inference_data.nc
      hash: md5
      md5: 266687c272a9e2db9fd690b3eead00a9
      size: 8502378
    - path: models_pgm/metadata.joblib
      hash: md5
      md5: 1aca9e8251507c995733959f0d78451f
      size: 4078
    - path: models_pgm/pgm_metrics.json
      hash: md5
      md5: 921244797ef31ffe5a7a9d5256f7a341
      size: 182
    - path: models_pgm/pgm_parameters.json
      hash: md5
      md5: e4267d386541b99d07ac11ce2294b5ea
      size: 79798
    - path: models_pgm/scalers.joblib
      hash: md5
      md5: 2c5d6bca7f8aeef964bb8b8209e8fac5
      size: 2753
    - path: models_pgm/target_stats.joblib
      hash: md5
      md5: 073574cf6632c2712aadc3dd2b0b5c1e
      size: 47
    params:
      params.yaml:
        analyze_pgm.analysis_dir: analysis_pgm
        analyze_pgm.data_dir: euroleague_data
        analyze_pgm.model_dir: models_pgm
    outs:
    - path: analysis_pgm/context_effects.png
      hash: md5
      md5: 16d5a7284e2969b5247c5b5c99fafcfa
      size: 15193
    - path: analysis_pgm/detailed_analysis.json
      hash: md5
      md5: 5ef805dadd412f2f3b0f06690b6506e9
      size: 7635
    - path: analysis_pgm/efficiency_effects.png
      hash: md5
      md5: 92acae7e2ff40cf80a7adbe5d95b897b
      size: 19293
    - path: analysis_pgm/group_effects.png
      hash: md5
      md5: 7f6bc162171685a61a9bb073ed825e73
      size: 27813
    - path: analysis_pgm/momentum_effects.png
      hash: md5
      md5: 5e73754e44c18b0a57fba7373dd5209d
      size: 16712
    - path: analysis_pgm/performance_effects.png
      hash: md5
      md5: 227de8be578fa92c237ef22c0967bfa7
      size: 15941
    - path: analysis_pgm/player_effects_dist.png
      hash: md5
      md5: 559387d3a7e6d4ea30b63f123a3170ad
      size: 36053
    - path: analysis_pgm/posterior_distributions.png
      hash: md5
      md5: 032147c83679bef7af7628ee86aa67e1
      size: 49633
    - path: analysis_pgm/prediction_accuracy.png
      hash: md5
      md5: 100114330a3692ba49e9162360ecac96
      size: 282542
    - path: analysis_pgm/tier_effects.png
      hash: md5
      md5: acbe3ddc05b0ac75fc830be3e8a642b9
      size: 18407
  load_data:
    cmd: uv run python -m src.euroleague_analysis.euroleague_data_collector
    deps:
    - path: src/euroleague_analysis/euroleague_data_collector.py
      hash: md5
      md5: 4a13f5453903a5c7aea255f7fa6e63a0
      size: 4781
    outs:
    - path: euroleague_data/raw/end_quarter_data_2023.parquet
      hash: md5
      md5: fe913d5dcf1c800b3632f3a4e1e78ca1
      size: 14145
    - path: euroleague_data/raw/playbyplay_data_2023.parquet
      hash: md5
      md5: c8b3b0d45dac4ce4a0eac5f1f6bd2224
      size: 1592319
    - path: euroleague_data/raw/player_stats_2023.parquet
      hash: md5
      md5: 9955a857ccb25ce04bf556cf729b76e4
      size: 191887
    - path: euroleague_data/raw/quarter_data_2023.parquet
      hash: md5
      md5: b813e598908055a5eaec95a982856ad1
      size: 13618
    - path: euroleague_data/raw/shot_data_2023.parquet
      hash: md5
      md5: 22f7d08ae84ea53def1c46c6d3b3fdcc
      size: 947024
  feature_engineering:
    cmd: uv run python -m src.euroleague_analysis.feature_engineering
    deps:
    - path: euroleague_data/raw/playbyplay_data_2023.parquet
      hash: md5
      md5: c8b3b0d45dac4ce4a0eac5f1f6bd2224
      size: 1592319
    - path: euroleague_data/raw/player_stats_2023.parquet
      hash: md5
      md5: 9955a857ccb25ce04bf556cf729b76e4
      size: 191887
    - path: euroleague_data/raw/shot_data_2023.parquet
      hash: md5
      md5: 22f7d08ae84ea53def1c46c6d3b3fdcc
      size: 947024
    - path: src/euroleague_analysis/feature_engineering
      hash: md5
      md5: 42614de6d421902a3d69914e9ebfc571.dir
      size: 12842
      nfiles: 8
    - path: src/euroleague_analysis/sql_queries
      hash: md5
      md5: 253aedbfae60c8f5ce83891b2e2e9690.dir
      size: 16048
      nfiles: 3
    outs:
    - path: euroleague_data/features.duckdb
      hash: md5
      md5: 5099d716cb2aed9442409c0bd23a0391
      size: 274432
    - path: euroleague_data/features.parquet
      hash: md5
      md5: eef0b90ad35150a14d3716866d69d108
      size: 207364
    - path: feature_outputs.json
      hash: md5
      md5: 0056b3ffb8dd45806e29110d7b18e3b2
      size: 156
  train_model:
    cmd: uv run python -m src.euroleague_analysis.train_model
    deps:
    - path: euroleague_data/features.parquet
      hash: md5
      md5: eef0b90ad35150a14d3716866d69d108
      size: 207364
    - path: params.yaml
      hash: md5
      md5: 39bccc5e35085f5131bc62f845badf16
      size: 751
    - path: src/euroleague_analysis/model_config.py
      hash: md5
      md5: 060e1e5292b27e20a14d27499a0bea07
      size: 1577
    - path: src/euroleague_analysis/train_model.py
      hash: md5
      md5: aaa68d53d1656d1204d01f3cdaa5976e
      size: 9794
    outs:
    - path: models/metrics.json
      hash: md5
      md5: aade823b3e597c168e53da05cd8d5e29
      size: 735
    - path: models/pir_predictor.joblib
      hash: md5
      md5: f9e2d29349ded6b9db8afde95e61be38
      size: 239816
    - path: models/plots/cv_scores_distribution.png
      hash: md5
      md5: dce51fb6e318e0cd9f053f80f9a279dd
      size: 27168
    - path: models/plots/learning_curves.png
      hash: md5
      md5: 9be1a3427f5cc9a47e2817af8275af47
      size: 38100
    - path: models/plots/prediction_scatter.png
      hash: md5
      md5: ce21fa534a638ffb4d69c5d915df582e
      size: 110545
    - path: models/scaler.joblib
      hash: md5
      md5: ba22cfe834f746e6ed23bc573af23ef4
      size: 2207
